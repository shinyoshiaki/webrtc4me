{"version":3,"sources":["../../lib/modules/stream.js","../../lib/modules/file.js","webrtc/signaling.ts","App.tsx","serviceWorker.ts","index.tsx","../../lib/utill/media.js","../../lib/index.js","../../lib/core.js"],"names":["Object","defineProperty","exports","value","tslib_1","__webpack_require__","core_1","__importDefault","rx_mini_1","MediaType","Stream","peer","opt","this","onStream","default","onLocalStream","initDone","label","listen","prototype","__awaiter","_a","get","stream","immidiate","track","localStream","_this","__generator","_b","init","catch","console","log","sent","execute","onData","once","raw","data","send","media","newPeer","isOffer","makeOffer","onSignal","sdp","JSON","stringify","setSdp","parse","onAddTrack","rxjs_1","chunkSize","getSliceArrayBuffer","blob","subject","Subject","state","asObservable","r","FileReader","blobSlice","File","slice","chunks","Math","ceil","size","currentChunk","loadNext","start","end","readAsArrayBuffer","call","onerror","e","error","onload","chunk","target","result","next","complete","FileShare","name","subscribe","obj","type","payload","push","now","length","sendStart","sendChunk","sendEnd","socket","client","connect","create","roomId","trickle","Promise","resolve","rtc","WebRTC","nodeId","emit","on","onConnect","unSubscribe","message","join","App","_useState","useState","_useState2","slicedToArray","setRoomId","_useState3","_useState4","roomLabel","setRoomLabel","_useState5","_useState6","setTrickle","_useState7","undefined","_useState8","setRTC","_useState9","_useState10","text","setText","videoRef","useRef","useEffect","loadStream","_ref","asyncToGenerator","regenerator_default","a","mark","_callee","wrap","_context","prev","current","srcObject","addTrack","getVideoTracks","getLocalVideo","stop","_x","apply","arguments","react_default","createElement","checked","onChange","placeholder","onClick","_callee2","_context2","_callee3","_context3","ref","autoPlay","style","width","height","index_es","multiline","Boolean","window","location","hostname","match","ReactDOM","render","src_App","document","getElementById","navigator","serviceWorker","ready","then","registration","unregister","option","mediaDevices","getUserMedia","audio","video","getLocalAudio","getLocalDesktop","getDisplayMedia","stream_1","file_1","Utill","__importStar","wrtc_1","onDisconnect","isConnected","isDisconnected","negotiating","dataChannels","prepareNewConnection","getTracks","forEach","disable_stun","RTCPeerConnection","iceServers","urls","ontrack","evt","streams","remoteStream","oniceconnectionstatechange","iceConnectionState","timeoutPing","setTimeout","hangUp","warn","clearTimeout","onicecandidate","candidate","ice","localDescription","ondatachannel","dataChannel","channel","dataChannelEvents","onsignalingstatechange","signalingState","createDatachannel","onnegotiationneeded","local","createOffer","setLocalDescription","err","negotiation","options","sessionDescription","trys","setAnswer","setRemoteDescription","RTCSessionDescription","makeAnswer","offer","answer","createAnswer","addIceCandidate","RTCIceCandidate","dc","dce_1","keys","includes","createDataChannel","onopen","onmessage","event","onclose","disconnect","key","close","onicegatheringstatechange"],"mappings":"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","file":"static/js/main.43c61a97.chunk.js","sourcesContent":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar tslib_1 = require(\"tslib\");\n\nvar core_1 = tslib_1.__importDefault(require(\"../core\"));\n\nvar rx_mini_1 = tslib_1.__importDefault(require(\"rx.mini\"));\n\nvar MediaType;\n\n(function (MediaType) {\n  MediaType[MediaType[\"video\"] = 0] = \"video\";\n  MediaType[MediaType[\"audio\"] = 1] = \"audio\";\n})(MediaType = exports.MediaType || (exports.MediaType = {}));\n\nvar Stream =\n/** @class */\nfunction () {\n  function Stream(peer, opt) {\n    if (opt === void 0) {\n      opt = {};\n    }\n\n    this.peer = peer;\n    this.opt = opt;\n    this.onStream = new rx_mini_1.default();\n    this.onLocalStream = new rx_mini_1.default();\n    this.initDone = false;\n    this.label = opt.label || \"stream\";\n    this.listen();\n  }\n\n  Stream.prototype.listen = function () {\n    return tslib_1.__awaiter(this, void 0, void 0, function () {\n      var label, _a, get, stream, immidiate, track, localStream;\n\n      var _this = this;\n\n      return tslib_1.__generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            label = \"init_\" + this.label;\n            _a = this.opt, get = _a.get, stream = _a.stream, immidiate = _a.immidiate, track = _a.track;\n            localStream = stream;\n            if (!immidiate) return [3\n            /*break*/\n            , 1];\n            this.init({\n              stream: localStream,\n              track: track\n            });\n            return [3\n            /*break*/\n            , 4];\n\n          case 1:\n            if (!get) return [3\n            /*break*/\n            , 3];\n            return [4\n            /*yield*/\n            , get.catch(console.log)];\n\n          case 2:\n            localStream = _b.sent();\n            this.onLocalStream.execute(localStream);\n            _b.label = 3;\n\n          case 3:\n            this.peer.onData.once(function (raw) {\n              if (raw.label === label && raw.data === \"done\") {\n                if (!get) {\n                  _this.init({\n                    stream: localStream,\n                    track: track\n                  });\n                }\n              }\n            });\n            this.peer.send(\"done\", label);\n            _b.label = 4;\n\n          case 4:\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n\n  Stream.prototype.init = function (media) {\n    return tslib_1.__awaiter(this, void 0, void 0, function () {\n      var stream, track, peer, newPeer;\n\n      var _this = this;\n\n      return tslib_1.__generator(this, function (_a) {\n        stream = media.stream, track = media.track;\n        if (this.initDone) return [2\n        /*return*/\n        ];\n        this.initDone = true;\n        peer = this.peer;\n        newPeer = new core_1.default({\n          stream: stream,\n          track: track\n        });\n\n        if (peer.isOffer) {\n          newPeer.makeOffer();\n          newPeer.onSignal.once(function (sdp) {\n            peer.send(JSON.stringify(sdp), _this.label + \"_offer\");\n          });\n          peer.onData.once(function (raw) {\n            if (raw.label === _this.label + \"_answer\") {\n              newPeer.setSdp(JSON.parse(raw.data));\n            }\n          });\n        } else {\n          peer.onData.once(function (raw) {\n            if (raw.label === _this.label + \"_offer\") {\n              newPeer.setSdp(JSON.parse(raw.data));\n              newPeer.onSignal.once(function (sdp) {\n                peer.send(JSON.stringify(sdp), _this.label + \"_answer\");\n              });\n            }\n          });\n        }\n\n        newPeer.onAddTrack.once(function (stream) {\n          _this.onStream.execute(stream);\n        });\n        return [2\n        /*return*/\n        ];\n      });\n    });\n  };\n\n  return Stream;\n}();\n\nexports.default = Stream;","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar rxjs_1 = require(\"rxjs\");\n\nvar chunkSize = 16000;\n\nfunction getSliceArrayBuffer(blob) {\n  var subject = new rxjs_1.Subject();\n  var state = subject.asObservable();\n  var r = new FileReader(),\n      blobSlice = File.prototype.slice,\n      chunks = Math.ceil(blob.size / chunkSize);\n  var currentChunk = 0;\n\n  r.onerror = function (e) {\n    subject.error(e);\n  };\n\n  r.onload = function (e) {\n    var chunk = e.target.result;\n    currentChunk++;\n\n    if (currentChunk < chunks) {\n      loadNext();\n      subject.next(chunk);\n    } else {\n      subject.complete();\n    }\n  };\n\n  function loadNext() {\n    var start = currentChunk * chunkSize;\n    var end = start + chunkSize >= blob.size ? blob.size : start + chunkSize;\n    r.readAsArrayBuffer(blobSlice.call(blob, start, end));\n  }\n\n  loadNext();\n  return state;\n}\n\nexports.getSliceArrayBuffer = getSliceArrayBuffer;\n\nvar FileShare =\n/** @class */\nfunction () {\n  function FileShare(peer, label) {\n    var _this = this;\n\n    this.peer = peer;\n    this.label = label;\n    this.subject = new rxjs_1.Subject();\n    this.state = this.subject.asObservable();\n    this.chunks = [];\n    this.name = \"\";\n    this.size = 0;\n    if (!label) label = \"file\";\n    console.log({\n      label: label\n    });\n    peer.onData.subscribe(function (raw) {\n      var label = raw.label,\n          data = raw.data;\n\n      if (label === _this.label) {\n        try {\n          var obj = JSON.parse(data);\n\n          switch (obj.state) {\n            case \"start\":\n              _this.chunks = [];\n              _this.name = obj.name;\n              _this.size = obj.size;\n              break;\n\n            case \"end\":\n              _this.subject.next({\n                type: \"downloaded\",\n                payload: {\n                  chunks: _this.chunks,\n                  name: _this.name\n                }\n              });\n\n              peer.send(JSON.stringify({\n                state: \"complete\",\n                name: _this.name\n              }), _this.label);\n              _this.chunks = [];\n              _this.name = \"\";\n              break;\n          }\n        } catch (error) {\n          _this.chunks.push(data);\n\n          _this.subject.next({\n            type: \"downloading\",\n            payload: {\n              now: _this.chunks.length * chunkSize,\n              size: _this.size\n            }\n          });\n        }\n      }\n    });\n  }\n\n  FileShare.prototype.sendStart = function (name, size) {\n    this.name = name;\n    this.peer.send(JSON.stringify({\n      state: \"start\",\n      size: size,\n      name: name\n    }), this.label);\n  };\n\n  FileShare.prototype.sendChunk = function (chunk) {\n    this.peer.send(chunk, this.label);\n  };\n\n  FileShare.prototype.sendEnd = function () {\n    this.peer.send(JSON.stringify({\n      state: \"end\"\n    }), this.label);\n  };\n\n  FileShare.prototype.send = function (blob) {\n    var _this = this;\n\n    this.sendStart(blob.name, blob.size);\n    getSliceArrayBuffer(blob).subscribe(function (chunk) {\n      return _this.sendChunk(chunk);\n    }, function () {}, function () {\n      _this.sendEnd();\n    });\n  };\n\n  return FileShare;\n}();\n\nexports.default = FileShare;","import client from \"socket.io-client\";\nimport WebRTC from \"../../../lib\";\n\nconst url =\n  process.env.NODE_ENV === \"production\"\n    ? \"https://aqueous-earth-75182.herokuapp.com/\"\n    : \"https://aqueous-earth-75182.herokuapp.com/\";\n\nconst socket = client.connect(url);\n\nexport function create(roomId: string, trickle: boolean) {\n  return new Promise<WebRTC>(resolve => {\n    const rtc = new WebRTC({ nodeId: \"answer\", trickle });\n    socket.emit(\"create\", { roomId });\n    socket.on(\"sdp\", (data: { sdp: string }) => {\n      console.log({ data });\n      rtc.setSdp(data.sdp);\n    });\n\n    const onSignal = rtc.onSignal.subscribe(sdp => {\n      console.log({ sdp, roomId });\n      socket.emit(\"sdp\", { sdp, roomId });\n    });\n    rtc.onConnect.once(() => {\n      console.log(\"connect\");\n      onSignal.unSubscribe();\n      resolve(rtc);\n    });\n    rtc.onData.subscribe(message => {\n      console.log({ message });\n    });\n  });\n}\n\nexport function join(roomId: string, trickle: boolean) {\n  return new Promise<WebRTC>(resolve => {\n    const rtc = new WebRTC({ nodeId: \"offer\", trickle });\n    socket.emit(\"join\", { roomId });\n    socket.on(\"join\", () => {\n      rtc.makeOffer();\n    });\n    socket.on(\"sdp\", (data: { sdp: string }) => {\n      console.log({ data });\n      rtc.setSdp(data.sdp);\n    });\n\n    const onSignal = rtc.onSignal.subscribe(sdp => {\n      console.log({ sdp, roomId });\n      socket.emit(\"sdp\", { sdp, roomId });\n    });\n    rtc.onConnect.once(() => {\n      console.log(\"connect\");\n      resolve(rtc);\n      onSignal.unSubscribe();\n    });\n    rtc.onData.subscribe(message => {\n      console.log({ message });\n    });\n  });\n}\n","import React, { FunctionComponent, useState, useRef, useEffect } from \"react\";\nimport { create, join } from \"./webrtc/signaling\";\nimport { TextField } from \"@material-ui/core\";\nimport WebRTC from \"../../lib\";\nimport { getLocalVideo } from \"../../lib/utill/media\";\n\nconst App: FunctionComponent = () => {\n  const [roomId, setRoomId] = useState(\"\");\n  const [roomLabel, setRoomLabel] = useState(\"\");\n  const [trickle, setTrickle] = useState(false);\n  const [rtc, setRTC] = useState<WebRTC | undefined>(undefined);\n  const [text, setText] = useState(\"\");\n  const videoRef = useRef<any | undefined>(undefined);\n\n  useEffect(() => {\n    if (rtc) {\n      rtc.onData.subscribe(raw => {\n        if (raw.label === \"share\") setText(raw.data);\n      });\n    }\n  }, [rtc]);\n\n  const loadStream = async (peer: WebRTC) => {\n    peer.onAddTrack.subscribe(stream => {\n      if (videoRef) {\n        videoRef.current.srcObject = stream;\n      }\n      if (!peer.isOffer) {\n        peer.addTrack(stream.getVideoTracks()[0], stream);\n      }\n    });\n    const stream = await getLocalVideo();\n    if (peer.isOffer) {\n      peer.addTrack(stream.getVideoTracks()[0], stream);\n    }\n  };\n\n  return (\n    <div>\n      <p>webrtc</p>\n      <div>\n        trickle\n        <br />\n        <input\n          type=\"radio\"\n          checked={!trickle}\n          onChange={() => setTrickle(!trickle)}\n        />\n        off\n        <input\n          type=\"radio\"\n          checked={trickle}\n          onChange={() => setTrickle(!trickle)}\n        />\n        on\n      </div>\n      <br />\n      <input\n        onChange={e => {\n          setRoomId(e.target.value);\n        }}\n        placeholder=\"roomId\"\n        value={roomId}\n      />\n      <button\n        onClick={async () => {\n          console.log(\"create\");\n          setRoomLabel(\"room:\" + roomId + \" create\");\n          setRoomId(\"\");\n          const rtc = await create(roomId, trickle);\n          setRTC(rtc);\n          loadStream(rtc);\n        }}\n      >\n        create\n      </button>\n      <button\n        onClick={async () => {\n          console.log(\"join\");\n          setRoomLabel(\"room:\" + roomId + \" join\");\n          setRoomId(\"\");\n          const rtc = await join(roomId, trickle);\n          setRTC(rtc);\n          loadStream(rtc);\n        }}\n      >\n        join\n      </button>\n      <br />\n      <p>{roomLabel}</p>\n      <video\n        ref={videoRef}\n        autoPlay={true}\n        style={{ width: \"100%\", height: \"100%\" }}\n      />\n      <p>datachannel</p>\n      <TextField\n        multiline\n        value={text}\n        onChange={e => {\n          setText(e.target.value);\n          if (rtc) rtc.send(e.target.value, \"share\");\n        }}\n        style={{ width: \"40vw\" }}\n      />\n    </div>\n  );\n};\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read http://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      (process as { env: { [key: string]: string } }).env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit http://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See http://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: http://bit.ly/CRA-PWA\nserviceWorker.unregister();\n","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nfunction getLocalVideo(option) {\n  return new Promise(function (resolve) {\n    navigator.mediaDevices.getUserMedia({\n      audio: true,\n      video: option || true\n    }).then(function (stream) {\n      resolve(stream);\n    });\n  });\n}\n\nexports.getLocalVideo = getLocalVideo;\n\nfunction getLocalAudio() {\n  return new Promise(function (resolve) {\n    navigator.mediaDevices.getUserMedia({\n      audio: true,\n      video: false\n    }).then(function (stream) {\n      resolve(stream);\n    });\n  });\n}\n\nexports.getLocalAudio = getLocalAudio;\n\nfunction getLocalDesktop(option) {\n  return new Promise(function (resolve) {\n    navigator.mediaDevices.getDisplayMedia({\n      video: option || true\n    }).then(function (stream) {\n      resolve(stream);\n    });\n  });\n}\n\nexports.getLocalDesktop = getLocalDesktop;","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar tslib_1 = require(\"tslib\");\n\nvar core_1 = tslib_1.__importDefault(require(\"./core\"));\n\nvar stream_1 = tslib_1.__importDefault(require(\"./modules/stream\"));\n\nexports.Stream = stream_1.default;\n\nvar file_1 = tslib_1.__importDefault(require(\"./modules/file\"));\n\nexports.FileShare = file_1.default;\n\nvar Utill = tslib_1.__importStar(require(\"./utill/media\"));\n\nexports.Utill = Utill;\nexports.default = core_1.default;","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar tslib_1 = require(\"tslib\");\n\nvar wrtc_1 = require(\"wrtc\");\n\nvar rx_mini_1 = tslib_1.__importDefault(require(\"rx.mini\"));\n\nvar WebRTC =\n/** @class */\nfunction () {\n  function WebRTC(opt) {\n    var _this = this;\n\n    if (opt === void 0) {\n      opt = {};\n    }\n\n    this.opt = opt;\n    this.onSignal = new rx_mini_1.default();\n    this.onConnect = new rx_mini_1.default();\n    this.onDisconnect = new rx_mini_1.default();\n    this.onData = new rx_mini_1.default();\n    this.onAddTrack = new rx_mini_1.default();\n    this.isConnected = false;\n    this.isDisconnected = false;\n    this.isOffer = false;\n    this.negotiating = false;\n    var nodeId = opt.nodeId,\n        stream = opt.stream,\n        track = opt.track;\n    this.dataChannels = {};\n    this.nodeId = nodeId || \"peer\";\n    this.rtc = this.prepareNewConnection();\n\n    if (stream) {\n      stream.getTracks().forEach(function (track) {\n        return _this.rtc.addTrack(track, stream);\n      });\n    } else if (track) {\n      this.rtc.addTrack(track);\n    }\n  }\n\n  WebRTC.prototype.prepareNewConnection = function () {\n    var _this = this;\n\n    var _a = this.opt,\n        disable_stun = _a.disable_stun,\n        trickle = _a.trickle;\n    var peer = disable_stun ? new wrtc_1.RTCPeerConnection({\n      iceServers: []\n    }) : new wrtc_1.RTCPeerConnection({\n      iceServers: [{\n        urls: \"stun:stun.l.google.com:19302\"\n      }]\n    });\n\n    peer.ontrack = function (evt) {\n      var stream = evt.streams[0];\n\n      _this.onAddTrack.execute(stream);\n\n      _this.remoteStream = stream;\n    };\n\n    peer.oniceconnectionstatechange = function () {\n      switch (peer.iceConnectionState) {\n        case \"failed\":\n          break;\n\n        case \"disconnected\":\n          try {\n            _this.timeoutPing = setTimeout(function () {\n              _this.hangUp();\n            }, 2000);\n\n            _this.send(\"ping\", \"live\");\n          } catch (error) {\n            console.warn({\n              error: error\n            });\n          }\n\n          break;\n\n        case \"connected\":\n          if (_this.timeoutPing) clearTimeout(_this.timeoutPing);\n          break;\n\n        case \"closed\":\n          break;\n\n        case \"completed\":\n          break;\n      }\n    };\n\n    peer.onicecandidate = function (evt) {\n      if (!_this.isConnected) {\n        if (evt.candidate) {\n          if (trickle) {\n            _this.onSignal.execute({\n              type: \"candidate\",\n              ice: evt.candidate\n            });\n          }\n        } else {\n          if (!trickle && peer.localDescription) {\n            _this.onSignal.execute(peer.localDescription);\n          }\n        }\n      }\n    };\n\n    peer.ondatachannel = function (evt) {\n      var dataChannel = evt.channel;\n      _this.dataChannels[dataChannel.label] = dataChannel;\n\n      _this.dataChannelEvents(dataChannel);\n    };\n\n    peer.onsignalingstatechange = function (e) {\n      _this.negotiating = peer.signalingState != \"stable\";\n    };\n\n    return peer;\n  };\n\n  WebRTC.prototype.hangUp = function () {\n    this.isDisconnected = true;\n    this.isConnected = false;\n    this.onDisconnect.execute();\n  };\n\n  WebRTC.prototype.makeOffer = function () {\n    var _this = this;\n\n    this.isOffer = true;\n    var trickle = this.opt.trickle;\n    this.createDatachannel(\"datachannel\");\n\n    this.rtc.onnegotiationneeded = function () {\n      return tslib_1.__awaiter(_this, void 0, void 0, function () {\n        var sdp, result, local;\n        return tslib_1.__generator(this, function (_a) {\n          switch (_a.label) {\n            case 0:\n              if (this.negotiating || this.rtc.signalingState != \"stable\") return [2\n              /*return*/\n              ];\n              this.negotiating = true;\n              return [4\n              /*yield*/\n              , this.rtc.createOffer().catch(console.warn)];\n\n            case 1:\n              sdp = _a.sent();\n              if (!sdp) return [2\n              /*return*/\n              ];\n              return [4\n              /*yield*/\n              , this.rtc.setLocalDescription(sdp).catch(function (err) {\n                return JSON.stringify(err) + \"err\";\n              })];\n\n            case 2:\n              result = _a.sent();\n\n              if (typeof result === \"string\") {\n                return [2\n                /*return*/\n                ];\n              }\n\n              local = this.rtc.localDescription;\n\n              if (trickle && local) {\n                this.onSignal.execute(local);\n              }\n\n              this.negotiation();\n              return [2\n              /*return*/\n              ];\n          }\n        });\n      });\n    };\n  };\n\n  WebRTC.prototype.negotiation = function () {\n    var _this = this;\n\n    this.rtc.onnegotiationneeded = function () {\n      return tslib_1.__awaiter(_this, void 0, void 0, function () {\n        var options, sessionDescription, local;\n        return tslib_1.__generator(this, function (_a) {\n          switch (_a.label) {\n            case 0:\n              if (!this.isConnected) return [2\n              /*return*/\n              ];\n              _a.label = 1;\n\n            case 1:\n              _a.trys.push([1,, 4, 5]);\n\n              if (this.negotiating || this.rtc.signalingState != \"stable\") return [2\n              /*return*/\n              ];\n              this.negotiating = true;\n              options = {};\n              return [4\n              /*yield*/\n              , this.rtc.createOffer(options).catch()];\n\n            case 2:\n              sessionDescription = _a.sent();\n              return [4\n              /*yield*/\n              , this.rtc.setLocalDescription(sessionDescription).catch()];\n\n            case 3:\n              _a.sent();\n\n              local = this.rtc.localDescription;\n\n              if (local) {\n                this.send(JSON.stringify(local), \"update\");\n              }\n\n              return [3\n              /*break*/\n              , 5];\n\n            case 4:\n              this.negotiating = false;\n              return [7\n              /*endfinally*/\n              ];\n\n            case 5:\n              return [2\n              /*return*/\n              ];\n          }\n        });\n      });\n    };\n  };\n\n  WebRTC.prototype.setAnswer = function (sdp) {\n    return tslib_1.__awaiter(this, void 0, void 0, function () {\n      return tslib_1.__generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            if (!this.isOffer) return [3\n            /*break*/\n            , 2];\n            return [4\n            /*yield*/\n            , this.rtc.setRemoteDescription(new wrtc_1.RTCSessionDescription(sdp)).catch(console.warn)];\n\n          case 1:\n            _a.sent();\n\n            _a.label = 2;\n\n          case 2:\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n\n  WebRTC.prototype.makeAnswer = function (offer) {\n    return tslib_1.__awaiter(this, void 0, void 0, function () {\n      var trickle, answer, local;\n      return tslib_1.__generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            trickle = this.opt.trickle;\n            return [4\n            /*yield*/\n            , this.rtc.setRemoteDescription(new wrtc_1.RTCSessionDescription(offer)).catch(console.warn)];\n\n          case 1:\n            _a.sent();\n\n            return [4\n            /*yield*/\n            , this.rtc.createAnswer().catch(console.warn)];\n\n          case 2:\n            answer = _a.sent();\n\n            if (!answer) {\n              console.warn(\"no answer\");\n              return [2\n              /*return*/\n              ];\n            }\n\n            return [4\n            /*yield*/\n            , this.rtc.setLocalDescription(answer).catch(console.warn)];\n\n          case 3:\n            _a.sent();\n\n            local = this.rtc.localDescription;\n\n            if (this.isConnected) {\n              this.send(JSON.stringify(local), \"update\");\n            } else if (trickle && local) {\n              this.onSignal.execute(local);\n            }\n\n            this.negotiation();\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n\n  WebRTC.prototype.setSdp = function (sdp) {\n    return tslib_1.__awaiter(this, void 0, void 0, function () {\n      var _a;\n\n      return tslib_1.__generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            _a = sdp.type;\n\n            switch (_a) {\n              case \"offer\":\n                return [3\n                /*break*/\n                , 1];\n\n              case \"answer\":\n                return [3\n                /*break*/\n                , 2];\n\n              case \"candidate\":\n                return [3\n                /*break*/\n                , 3];\n            }\n\n            return [3\n            /*break*/\n            , 5];\n\n          case 1:\n            this.makeAnswer(sdp);\n            return [3\n            /*break*/\n            , 5];\n\n          case 2:\n            this.setAnswer(sdp);\n            return [3\n            /*break*/\n            , 5];\n\n          case 3:\n            return [4\n            /*yield*/\n            , this.rtc.addIceCandidate(new wrtc_1.RTCIceCandidate(sdp.ice)).catch(console.warn)];\n\n          case 4:\n            _b.sent();\n\n            return [3\n            /*break*/\n            , 5];\n\n          case 5:\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n\n  WebRTC.prototype.createDatachannel = function (label) {\n    return tslib_1.__awaiter(this, void 0, void 0, function () {\n      var dc, dce_1;\n      return tslib_1.__generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            if (!!Object.keys(this.dataChannels).includes(label)) return [3\n            /*break*/\n            , 4];\n            _a.label = 1;\n\n          case 1:\n            _a.trys.push([1, 3,, 4]);\n\n            dc = this.rtc.createDataChannel(label);\n            this.dataChannels[label] = dc;\n            return [4\n            /*yield*/\n            , this.dataChannelEvents(dc)];\n\n          case 2:\n            _a.sent();\n\n            return [3\n            /*break*/\n            , 4];\n\n          case 3:\n            dce_1 = _a.sent();\n            console.error(dce_1);\n            return [3\n            /*break*/\n            , 4];\n\n          case 4:\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n\n  WebRTC.prototype.dataChannelEvents = function (channel) {\n    var _this = this;\n\n    return new Promise(function (resolve) {\n      channel.onopen = function () {\n        if (!_this.isConnected) {\n          _this.isConnected = true;\n\n          _this.onConnect.execute();\n        }\n\n        resolve();\n      };\n\n      channel.onmessage = function (event) {\n        return tslib_1.__awaiter(_this, void 0, void 0, function () {\n          var sdp;\n          return tslib_1.__generator(this, function (_a) {\n            if (!event) return [2\n            /*return*/\n            ];\n\n            try {\n              if (channel.label === \"update\") {\n                sdp = JSON.parse(event.data);\n                this.setSdp(sdp);\n              } else if (channel.label === \"live\") {\n                if (event.data === \"ping\") this.send(\"pong\", \"live\");else if (this.timeoutPing) clearTimeout(this.timeoutPing);\n              } else {\n                this.onData.execute({\n                  label: channel.label,\n                  data: event.data,\n                  nodeId: this.nodeId\n                });\n              }\n            } catch (error) {\n              console.warn(error);\n            }\n\n            return [2\n            /*return*/\n            ];\n          });\n        });\n      };\n\n      channel.onerror = function (err) {\n        return console.warn(err);\n      };\n\n      channel.onclose = function () {};\n    });\n  };\n\n  WebRTC.prototype.send = function (data, label) {\n    return tslib_1.__awaiter(this, void 0, void 0, function () {\n      return tslib_1.__generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            label = label || \"datachannel\";\n            if (!!Object.keys(this.dataChannels).includes(label)) return [3\n            /*break*/\n            , 2];\n            return [4\n            /*yield*/\n            , this.createDatachannel(label)];\n\n          case 1:\n            _a.sent();\n\n            _a.label = 2;\n\n          case 2:\n            try {\n              this.dataChannels[label].send(data);\n            } catch (error) {\n              console.warn(error);\n            }\n\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n\n  WebRTC.prototype.addTrack = function (track, stream) {\n    this.rtc.addTrack(track, stream);\n  };\n\n  WebRTC.prototype.disconnect = function () {\n    return tslib_1.__awaiter(this, void 0, void 0, function () {\n      var _a, rtc, dataChannels, key, channel;\n\n      return tslib_1.__generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            _a = this, rtc = _a.rtc, dataChannels = _a.dataChannels;\n\n            for (key in dataChannels) {\n              channel = dataChannels[key];\n              channel.onmessage = null;\n              channel.onopen = null;\n              channel.onclose = null;\n              channel.onerror = null;\n              channel.close();\n            }\n\n            this.dataChannels = null;\n            rtc.oniceconnectionstatechange = null;\n            rtc.onicegatheringstatechange = null;\n            rtc.onsignalingstatechange = null;\n            rtc.onicecandidate = null;\n            rtc.ontrack = null;\n            rtc.ondatachannel = null;\n            rtc.close();\n            this.rtc = null;\n            return [4\n            /*yield*/\n            , new Promise(function (r) {\n              return setTimeout(r, 1000 * 30);\n            })];\n\n          case 1:\n            _b.sent();\n\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n\n  return WebRTC;\n}();\n\nexports.default = WebRTC;"],"sourceRoot":""}